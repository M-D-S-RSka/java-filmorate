DROP ALL OBJECTS;

CREATE TABLE IF NOT EXISTS Users (
    user_id  INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    email    VARCHAR(50) NOT NULL UNIQUE,
    login    VARCHAR(50) NOT NULL UNIQUE,
    name     VARCHAR(50),
    birthday DATE        NOT NULL
);

CREATE TABLE IF NOT EXISTS Friendship (
    user_id   INTEGER NOT NULL REFERENCES Users (user_id) ON DELETE CASCADE,
    friend_id INTEGER NOT NULL REFERENCES Users (user_id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Genre (
    genre_id   INTEGER PRIMARY KEY,
    genre_name VARCHAR NOT NULL
);

CREATE TABLE IF NOT EXISTS Mpa (
    mpa_id INTEGER PRIMARY KEY,
    type   VARCHAR NOT NULL
);

CREATE TABLE IF NOT EXISTS Films (
    film_id      INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name         VARCHAR(100) NOT NULL,
    description  VARCHAR(200) NOT NULL,
    release_date DATE NOT NULL ,
    duration     INTEGER NOT NULL,
    mpa_id       INTEGER NOT NULL REFERENCES Mpa (mpa_id) ON DELETE RESTRICT
);

CREATE TABLE IF NOT EXISTS Film_genre (
    film_id  INTEGER NOT NULL REFERENCES Films (film_id) ON DELETE CASCADE,
    genre_id INTEGER NOT NULL REFERENCES GENRE (genre_id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Likes (
    film_id INTEGER NOT NULL REFERENCES Films (film_id) ON DELETE CASCADE,
    user_id INTEGER NOT NULL REFERENCES Users (user_id) ON DELETE CASCADE
);